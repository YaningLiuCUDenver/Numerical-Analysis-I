
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>5.4 Multiple integrals &#8212; First Semester in Numerical Analysis with Python</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" href="_static/styles/sphinx-book-theme.css?digest=62ba249389abaaa9ffc34bf36a076bdc1d65ee18" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/proof.css" />
    <link rel="stylesheet" type="text/css" href="_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/scripts/sphinx-book-theme.js?digest=f31d14ad54b65d19161ba51d4ffff3a77ae00456"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="5.5 Improper integrals" href="bookchapter5-5.html" />
    <link rel="prev" title="5.3 Gaussian quadrature" href="bookchapter5-3.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="_static/logo.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">First Semester in Numerical Analysis with Python</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="bookintro.html">
                    Welcome to First Semester in Numerical Analysis with Python
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="bookpreface.html">
   Preface
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="bookchapter1-0.html">
   Chapter 1 Introduction
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="bookchapter1-1.html">
   1.1 Review of Calculus
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="bookchapter1-2.html">
   1.2 Python basics
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="bookchapter1-3.html">
   1.3 Computer arithmetic
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="bookchapter2-0.html">
   Chapter 2 Solutions of equations: Root-finding
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="bookchapter2-1.html">
   2.1 Error analysis for iterative methods
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="bookchapter2-2.html">
   2.2 Bisection method
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="bookchapter2-3.html">
   2.3 Newton’s method
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="bookchapter2-4.html">
   2.4 Secant method
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="bookchapter2-5.html">
   2.5 Muller’s method
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="bookchapter2-6.html">
   2.6 Fixed-point iteration
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="bookchapter2-7.html">
   2.7 High-order fixed-point iteration
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="bookchapter3-0.html">
   Chapter 3 Solutions to linear systems
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="bookchapter3-1.html">
   3.1 Gaussian elimination
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="bookchapter3-2.html">
   3.2 Iterative methods for solving linear systems
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="bookchapter3-3.html">
   3.3 Cholesky decomposition
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="bookchapter4-0.html">
   Chapter 4 Interpolation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="bookchapter4-1.html">
   4.1 Polynomial interpolation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="bookchapter4-2.html">
   4.2 High degree polynomial interpolation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="bookchapter4-3.html">
   4.3 Hermite interpolation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="bookchapter4-4.html">
   4.4 Piecewise polynomials: spline interpolation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="bookchapter5-1.html">
   5.1 Newton-Cotes formulas
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="bookchapter5-2.html">
   5.2 Composite Newton-Cotes formulas
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="bookchapter5-3.html">
   5.3 Gaussian quadrature
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   5.4 Multiple integrals
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="bookchapter5-5.html">
   5.5 Improper integrals
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="bookchapter5-6.html">
   5.6 Numerical differentiation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="bookchapter6-0.html">
   Chapter 6 Approximation Theory
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="bookchapter6-1.html">
   6.1 Discrete least squares
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="bookchapter6-2.html">
   6.2 Continuous least squares
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="bookchapter6-3.html">
   6.3 Orthogonal polynomials and least squares
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="bookchapter7-0.html">
   Chapter 7 Numerical Optimization
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="bookchapter7-1.html">
   7.1 Golden-section search
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="bookchapter7-2.html">
   7.2 Derivative-based optimization
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<div class="menu-dropdown menu-dropdown-launch-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Launch interactive content">
      <i class="fas fa-rocket"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://mybinder.org/v2/gh/executablebooks/jupyter-book/master?urlpath=tree/bookchapter5-4.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Binder"
>
  

<span class="headerbtn__icon-container">
  
    <img src="_static/images/logo_binder.svg">
  </span>
<span class="headerbtn__text-container">Binder</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="_sources/bookchapter5-4.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.ipynb</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>5.4 Multiple integrals</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section class="tex2jax_ignore mathjax_ignore" id="multiple-integrals">
<h1>5.4 Multiple integrals<a class="headerlink" href="#multiple-integrals" title="Permalink to this headline">#</a></h1>
<p>The numerical quadrature methods we have discussed can be generalized
to higher dimensional integrals. We will consider the two-dimensional
integral</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{equation*}
\int\int_{R}f(x,y)dA.
\end{equation*}\]</div>
<p>The domain <span class="math notranslate nohighlight">\(R\)</span> determines the difficulty in generalizing the one-dimensional
formulas we learned before. The simplest case would be a rectangular
domain <span class="math notranslate nohighlight">\(R=\{(x,y)|a\leq x\leq b,c\leq y\leq d\}\)</span>. We can then write
the double integral as the iterated integral</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{equation*}
\int\int_{R}f(x,y)dA=\int_{a}^{b}\left(\int_{c}^{d}f(x,y)dy\right)dx.
\end{equation*}\]</div>
<p>Consider a numerical quadrature rule</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{equation*}
\int_{a}^{b}f(x)dx\approx\sum_{i=1}^{n}w_{i}f(x_{i}).
\end{equation*}\]</div>
<p>Apply the rule using <span class="math notranslate nohighlight">\(n_{2}\)</span> nodes to the inner integral to get the
approximation</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{equation*}
\int_{a}^{b}\left(\sum_{j=1}^{n_{2}}w_{j}f(x,y_{j})\right)dx
\end{equation*}\]</div>
<p>where the <span class="math notranslate nohighlight">\(y_{j}\)</span>’s are the nodes. Rewrite, by interchanging the integral and summation, to get</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{equation*}
\sum_{j=1}^{n_{2}}w_{j}\left(\int_{a}^{b}f(x,y_{j})dx\right)
\end{equation*}\]</div>
<p>and apply the quadrature rule again, using <span class="math notranslate nohighlight">\(n_{1}\)</span> nodes, to get
the approximation</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{equation*}
\sum_{j=1}^{n_{2}}w_{j}\left(\sum_{i=1}^{n_{1}}w_{i}f(x_{i},y_{j})\right).
\end{equation*}\]</div>
<p>This gives the two-dimensional rule</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{equation*}
\int_{a}^{b}\left(\int_{c}^{d}f(x,y)dy\right)dx\approx\sum_{j=1}^{n_{2}}\sum_{i=1}^{n_{1}}w_{i}w_{j}f(x_{i},y_{j}).
\end{equation*}\]</div>
<p>For simplicity, we ignored the error term in the above derivation;
however, its inclusion is straightforward.</p>
<p>For an example, let’s derive the two-dimensional Gauss-Legendre rule for the integral</p>
<div class="math notranslate nohighlight" id="equation-multiint-1">
<span class="eqno">(31)<a class="headerlink" href="#equation-multiint-1" title="Permalink to this equation">#</a></span>\[\int_{0}^{1}\int_{0}^{1}f(x,y)dydx\]</div>
<p>using two nodes for each axis. Note that each integral has to be transformed to
<span class="math notranslate nohighlight">\((-1,1).\)</span> Start with the inner integral <span class="math notranslate nohighlight">\(\int_{0}^{1}f(x,y)dy\)</span> and use</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{equation*}
t=2y-1, dt=2dy
\end{equation*}\]</div>
<p>to transform it to</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{equation*}
\frac{1}{2}\int_{-1}^{1}f\left(x,\frac{t+1}{2}\right)dt
\end{equation*}\]</div>
<p>and apply Gauss-Legendre rule with two nodes to get the approximation</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{equation*}
\frac{1}{2}\left(f\left(x,\frac{-1/\sqrt{3}+1}{2}\right)+f\left(x,\frac{1/\sqrt{3}+1}{2}\right)\right).
\end{equation*}\]</div>
<p>Substitute this approximation in <a class="reference internal" href="#equation-multiint-1">(31)</a> for the inner integral to get</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{equation*}
\int_{0}^{1} \frac{1}{2}\left(f\left(x,\frac{-1/\sqrt{3}+1}{2}\right)+f\left(x,\frac{1/\sqrt{3}+1}{2}\right)\right) dx.
\end{equation*}\]</div>
<p>Now transform this integral to the domain <span class="math notranslate nohighlight">\((-1,1)\)</span> using</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{equation*}
s=2x-1, ds=2dx
\end{equation*}\]</div>
<p>to get</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{equation*}
\frac{1}{4} \int_{0}^{1}\left(f\left(\frac{s+1}{2},\frac{-1/\sqrt{3}+1}{2}\right)+f\left(\frac{s+1}{2},\frac{1/\sqrt{3}+1}{2}\right)\right) ds.
\end{equation*}\]</div>
<p>Apply the Gauss-Legendre rule again to get</p>
<div class="math notranslate nohighlight" id="equation-compgaussresult">
<span class="eqno">(32)<a class="headerlink" href="#equation-compgaussresult" title="Permalink to this equation">#</a></span>\[\begin{split}\begin{align}
\frac{1}{4}  \Biggl[ &amp; f\left(\frac{-1/\sqrt{3}+1}{2},\frac{-1/\sqrt{3}+1}{2}\right)+f\left(\frac{-1/\sqrt{3}+1}{2},\frac{1/\sqrt{3}+1}{2}\right) \nonumber \\
&amp;+f\left(\frac{1/\sqrt{3}+1}{2},\frac{-1/\sqrt{3}+1}{2}\right)+f\left(\frac{1/\sqrt{3}+1}{2},\frac{1/\sqrt{3}+1}{2}\right)  \Biggr].
\end{align}\end{split}\]</div>
<p><a class="reference internal" href="#double-gaussian-rule"><span class="std std-numref">Figure 12</span></a> displays the nodes
used in this calculation.</p>
<figure class="align-default" id="double-gaussian-rule">
<a class="reference internal image-reference" href="_images/Gaussiannodes.png"><img alt="_images/Gaussiannodes.png" src="_images/Gaussiannodes.png" style="height: 450px;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 12 </span><span class="caption-text">Nodes of double Gauss-Legendre rule.</span><a class="headerlink" href="#double-gaussian-rule" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<p>Next we derive the two-dimensional Simpson’s
rule for the same integral, <span class="math notranslate nohighlight">\(\int_{0}^{1}\int_{0}^{1}f(x,y)dydx,\)</span> using <span class="math notranslate nohighlight">\(n=2\)</span>, which corresponds to three nodes in the Simpson’s rule (recall that <span class="math notranslate nohighlight">\(n\)</span> is the number of nodes in Gauss-Legendre rule, but <span class="math notranslate nohighlight">\(n+1\)</span> is the number of nodes in Newton-Cotes formulas).</p>
<p>The inner integral is approximated as</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{equation*}
\int_0^1 f(x,y)dy \approx \frac{1}{6} \left( f(x,0)+4f(x,0.5)+f(x,1) \right).
\end{equation*}\]</div>
<p>Substitute this approximation for the inner integral in <span class="math notranslate nohighlight">\(\int_{0}^{1}\left(\int_{0}^{1}f(x,y)dy\right)dx\)</span> to get</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{equation*}
\frac{1}{6} \int_0^1 \left( f(x,0)+4f(x,0.5)+f(x,1) \right) dx.
\end{equation*}\]</div>
<p>Apply Simpson’s rule again to this integral with <span class="math notranslate nohighlight">\(n=2\)</span> to obtain the final approximation:</p>
<div class="math notranslate nohighlight" id="equation-compsimpresult">
<span class="eqno">(33)<a class="headerlink" href="#equation-compsimpresult" title="Permalink to this equation">#</a></span>\[\begin{split}\begin{align}
\frac{1}{6} \Biggl[ \frac{1}{6} &amp;\biggl( f(0,0)+4f(0,0.5)+f(0,1)+4(f(0.5,0)+4f(0.5,0.5)+f(0.5,1)) \nonumber \\
&amp;+f(1,0)+4f(1,0.5)+f(1,1) \biggr) \Biggr].
\end{align}\end{split}\]</div>
<p><a class="reference internal" href="#double-simpson"><span class="std std-numref">Figure 13</span></a> displays the nodes used in the above calculation.</p>
<figure class="align-default" id="double-simpson">
<a class="reference internal image-reference" href="_images/d_SimpsonNodes.png"><img alt="_images/d_SimpsonNodes.png" src="_images/d_SimpsonNodes.png" style="height: 450px;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 13 </span><span class="caption-text">Nodes of double Simpson’s rule</span><a class="headerlink" href="#double-simpson" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<p>For a specific example, consider the integral</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{equation*}
\int_0^1 \int_0^1 \left(\frac{\pi}{2} \sin \pi x \right)\left(\frac{\pi}{2} \sin \pi y \right) dy dx.
\end{equation*}\]</div>
<p>This integral can be evaluated exactly, and its value is 1. It is used as a test integral for numerical quadrature rules. Evaluating Equations <a class="reference internal" href="#equation-compgaussresult">(32)</a> and <a class="reference internal" href="#equation-compsimpresult">(33)</a> with <span class="math notranslate nohighlight">\(f(x,y)= \left(\frac{\pi}{2} \sin \pi x \right)\left(\frac{\pi}{2} \sin \pi y \right)\)</span>, we obtain the approximations given in the table below:</p>
<table class="table">
<colgroup>
<col style="width: 33%" />
<col style="width: 33%" />
<col style="width: 33%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Simpson’s rule (9 nodes)</p></th>
<th class="head"><p>Gauss-Legendre (4 nodes)</p></th>
<th class="head"><p>Exact integral</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="math notranslate nohighlight">\(1.0966\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(0.93685\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(1\)</span></p></td>
</tr>
</tbody>
</table>
<p>The Gauss-Legendre rule gives a slightly better estimate than Simpson’s rule, but using less than half the number of nodes.</p>
<p>The approach we have discussed can be extended to regions that are
not rectangular, and to higher dimensions. More details, including algorithms for double and triple integrals using Simpson’s and
Gauss-Legendre rule, can be found in <span id="id1">Burden <em>et al.</em> [<a class="reference internal" href="#id6" title="R.L. Burden, D. Faires, and A.M. Burden. Numerical Analysis. Cengate, 10th edition, 2016.">2016</a>]</span>.</p>
<p>There is however, an obvious disadvantage of the way we have generalized
one-dimensional quadrature rules to higher dimensions. Imagine a numerical
integration problem where the dimension is 360; such high dimensions
appear in some problems from financial engineering. Even if we used
two nodes for each dimension, the total number of nodes would be <span class="math notranslate nohighlight">\(2^{360}\)</span>,
which is about <span class="math notranslate nohighlight">\(10^{100},\)</span> a number too large. In very large dimensions,
the only general method for numerical integration is the Monte Carlo
method. In Monte Carlo, we generate pseudorandom numbers from the
domain, and evaluate the function average at those points. In other
words,</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{equation*}
\int_{R}f(\boldsymbol{x})d\boldsymbol{x}\approx\frac{1}{n}\sum_{i=1}^{n}f(\boldsymbol{x}_{i})
\end{equation*}\]</div>
<p>where <span class="math notranslate nohighlight">\(\boldsymbol{x}_{i}\)</span> are pseudorandom vectors uniformly distributed in <span class="math notranslate nohighlight">\(R\)</span>.
For the two-dimensional integral we discussed before, the Monte Carlo
estimate is</p>
<div class="math notranslate nohighlight" id="equation-mc-est">
<span class="eqno">(34)<a class="headerlink" href="#equation-mc-est" title="Permalink to this equation">#</a></span>\[\begin{align}
\int_{a}^{b}\int_{c}^{d}f(x,y)dydx\approx\frac{(b-a)(d-c)}{n}\sum_{i=1}^{n}f(a+(b-a)x_{i},c+(d-c)y_{i})
\end{align}\]</div>
<p>where <span class="math notranslate nohighlight">\(x_{i},y_{i}\)</span> are pseudorandom numbers from <span class="math notranslate nohighlight">\((0,1)\)</span>. In Python, the function <strong>np.random.rand()</strong> generates a pseudorandom number from the uniform distribution between 0 and 1. The following code takes the endpoints of the intervals <span class="math notranslate nohighlight">\(a,b,c,d\)</span>, and the number of nodes <span class="math notranslate nohighlight">\(n\)</span> (which is called the sample size in the Monte Carlo literature) as inputs, and returns the estimate for the integral using Equation <a class="reference internal" href="#equation-mc-est">(34)</a>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">mc</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
    <span class="nb">sum</span> <span class="o">=</span> <span class="mf">0.</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
        <span class="nb">sum</span> <span class="o">+=</span> <span class="n">f</span><span class="p">(</span><span class="n">a</span><span class="o">+</span><span class="p">(</span><span class="n">b</span><span class="o">-</span><span class="n">a</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(),</span>
                 <span class="n">c</span><span class="o">+</span><span class="p">(</span><span class="n">d</span><span class="o">-</span><span class="n">c</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">())</span><span class="o">*</span><span class="p">(</span><span class="n">b</span><span class="o">-</span><span class="n">a</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">d</span><span class="o">-</span><span class="n">c</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">sum</span><span class="o">/</span><span class="n">n</span>
</pre></div>
</div>
</div>
</div>
<p>Now we use Monte Carlo to estimate the integral <span class="math notranslate nohighlight">\(\int_0^1 \int_0^1 \left(\frac{\pi}{2} \sin \pi x \right)\left(\frac{\pi}{2} \sin \pi y \right) dy dx\)</span>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mc</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">:</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="mi">4</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">x</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">y</span><span class="p">),</span>
   <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.947641468700812
</pre></div>
</div>
</div>
</div>
<p>With <span class="math notranslate nohighlight">\(n=500\)</span>,
we obtain a Monte Carlo estimate of 0.944178. An advantage of the Monte Carlo method is its simplicity: the above code can be easily generalized to higher dimensions.
A disadvantage of Monte Carlo is its slow rate of convergence,
which is <span class="math notranslate nohighlight">\(O(1/\sqrt{n}\)</span>). <a class="reference internal" href="#monte-carlo"><span class="std std-numref">Figure 14</span></a> displays
500 pseudorandom vectors from the unit square.</p>
<figure class="align-default" id="monte-carlo">
<a class="reference internal image-reference" href="_images/randomplot.png"><img alt="_images/randomplot.png" src="_images/randomplot.png" style="height: 450px;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 14 </span><span class="caption-text">Monte Carlo: 500 pseudorandom vectors</span><a class="headerlink" href="#monte-carlo" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<div class="proof example admonition" id="chap4_exa81">
<p class="admonition-title"><span class="caption-number">Example 50 </span></p>
<section class="example-content" id="proof-content">
<p><span id="id2">Capstick and Keister [<a class="reference internal" href="#id14" title="S. Capstick and B.D. Keister. Multidimensional quadrature algorithms at higher degree and/or dimension. Journal of Computational Physics, 123:267-273, 1996.">1996</a>]</span> discuss some high dimensional test integrals, some with analytical solutions, motivated by physical applications such as the calculation of quantum mechanical matrix elements in atomic, nuclear, and particle physics. One of the integrals with a known solution is</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{equation*}
\int_{\mathbb{R}^s} \cos (||\boldsymbol{t}||)) e^{-||\boldsymbol{t}||^2} dt_1 dt_2 \dotsb dt_s
\end{equation*}\]</div>
<p>where <span class="math notranslate nohighlight">\(||\boldsymbol{t}||=(t_1^2+\dotsc +t_s^2)^{1/2}\)</span>. This integral can be transformed to an integral over the <span class="math notranslate nohighlight">\(s\)</span>-dimensional unit cube as</p>
<div class="math notranslate nohighlight" id="equation-capstick-test">
<span class="eqno">(35)<a class="headerlink" href="#equation-capstick-test" title="Permalink to this equation">#</a></span>\[\begin{align}
\pi^{s/2} \int_{(0,1)^s} \cos \left[ \left( \frac{(F^{-1}(x_1))^2+\dotsc +(F^{-1}(x_s))^2}{2} \right)^{1/2} \right] dx_1 dx_2 \dotsb dx_s
\end{align}\]</div>
</section>
</div><p>where <span class="math notranslate nohighlight">\(F^{-1}\)</span> is the inverse of the cumulative distribution function of the standard normal distribution:</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{equation*}
F(x)=\frac{1}{(2\pi)^{1/2}} \int_{-\infty}^x e^{-s^2/2}ds.
\end{equation*}\]</div>
<p>We will estimate the integral <a class="reference internal" href="#equation-capstick-test">(35)</a> by Monte Carlo as</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{equation*}
\frac{\pi^{s/2}}{n} \sum_{i=1}^n \cos \left[ \left( \frac{(F^{-1}(x^{(i)}_1))^2+\dotsc +(F^{-1}(x^{(i)}_s))^2}{2} \right)^{1/2} \right]
\end{equation*}\]</div>
<p>where <span class="math notranslate nohighlight">\(\boldsymbol{x}^{(i)}=(x^{(i)}_1, \dotsc, x^{(i)}_s)\)</span> is an <span class="math notranslate nohighlight">\(s\)</span>-dimensional vector of uniform random numbers between 0 and 1.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="o">%</span><span class="k">matplotlib</span> inline
</pre></div>
</div>
</div>
</div>
<p>The following algorithm, known as the Beasley-Springer-Moro algorithm <span id="id3">Glasserman [<a class="reference internal" href="#id15" title="P. Glasserman. Monte Carlo methods in Financial Engineering. Springer, 2013.">2013</a>]</span>, gives
an approximation to <span class="math notranslate nohighlight">\(F^{-1}(x)\)</span>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">invNormal</span><span class="p">(</span><span class="n">u</span><span class="p">):</span>
    <span class="c1"># Beasley-Springer-Moro algorithm</span>
    <span class="n">a0</span> <span class="o">=</span> <span class="mf">2.50662823884</span>
    <span class="n">a1</span> <span class="o">=</span> <span class="o">-</span><span class="mf">18.61500062529</span>
    <span class="n">a2</span> <span class="o">=</span> <span class="mf">41.39119773534</span>
    <span class="n">a3</span> <span class="o">=</span> <span class="o">-</span><span class="mf">25.44106049637</span>
    <span class="n">b0</span> <span class="o">=</span> <span class="o">-</span><span class="mf">8.47351093090</span>
    <span class="n">b1</span> <span class="o">=</span> <span class="mf">23.08336743743</span>
    <span class="n">b2</span> <span class="o">=</span> <span class="o">-</span><span class="mf">21.06224101826</span>
    <span class="n">b3</span> <span class="o">=</span> <span class="mf">3.13082909833</span>
    <span class="n">c0</span> <span class="o">=</span> <span class="mf">0.3374754822726147</span>
    <span class="n">c1</span> <span class="o">=</span> <span class="mf">0.9761690190917186</span>
    <span class="n">c2</span> <span class="o">=</span> <span class="mf">0.1607979714918209</span>
    <span class="n">c3</span> <span class="o">=</span> <span class="mf">0.0276438810333863</span>
    <span class="n">c4</span> <span class="o">=</span> <span class="mf">0.0038405729373609</span>
    <span class="n">c5</span> <span class="o">=</span> <span class="mf">0.0003951896511919</span>
    <span class="n">c6</span> <span class="o">=</span> <span class="mf">0.0000321767881768</span>
    <span class="n">c7</span> <span class="o">=</span> <span class="mf">0.0000002888167364</span>
    <span class="n">c8</span> <span class="o">=</span> <span class="mf">0.0000003960315187</span>
    
    <span class="n">y</span> <span class="o">=</span> <span class="n">u</span><span class="o">-</span><span class="mf">0.5</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.42</span><span class="p">:</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">y</span><span class="o">*</span><span class="n">y</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">y</span><span class="o">*</span><span class="p">(((</span><span class="n">a3</span><span class="o">*</span><span class="n">r</span><span class="o">+</span><span class="n">a2</span><span class="p">)</span><span class="o">*</span><span class="n">r</span><span class="o">+</span><span class="n">a1</span><span class="p">)</span><span class="o">*</span><span class="n">r</span><span class="o">+</span><span class="n">a0</span><span class="p">)</span><span class="o">/</span><span class="p">((((</span><span class="n">b3</span><span class="o">*</span><span class="n">r</span><span class="o">+</span><span class="n">b2</span><span class="p">)</span><span class="o">*</span><span class="n">r</span><span class="o">+</span><span class="n">b1</span><span class="p">)</span><span class="o">*</span><span class="n">r</span><span class="o">+</span><span class="n">b0</span><span class="p">)</span><span class="o">*</span><span class="n">r</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">u</span>
        <span class="k">if</span> <span class="n">y</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">r</span> <span class="o">=</span> <span class="mi">1</span><span class="o">-</span><span class="n">u</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">r</span><span class="p">))</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">c0</span><span class="o">+</span><span class="n">r</span><span class="o">*</span><span class="p">(</span><span class="n">c1</span><span class="o">+</span><span class="n">r</span><span class="o">*</span><span class="p">(</span><span class="n">c2</span><span class="o">+</span><span class="n">r</span><span class="o">*</span><span class="p">(</span><span class="n">c3</span><span class="o">+</span><span class="n">r</span><span class="o">*</span><span class="p">(</span><span class="n">c4</span><span class="o">+</span><span class="n">r</span><span class="o">*</span><span class="p">(</span><span class="n">c5</span><span class="o">+</span><span class="n">r</span><span class="o">*</span><span class="p">(</span><span class="n">c6</span><span class="o">+</span><span class="n">r</span><span class="o">*</span><span class="p">(</span><span class="n">c7</span><span class="o">+</span><span class="n">r</span><span class="o">*</span><span class="n">c8</span><span class="p">)))))))</span>
        <span class="k">if</span> <span class="n">y</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">x</span> <span class="o">=</span> <span class="o">-</span><span class="n">x</span>
    <span class="k">return</span> <span class="n">x</span>
</pre></div>
</div>
</div>
</div>
<p>The following is the Monte Carlo estimate of the integral. It takes the
dimension <span class="math notranslate nohighlight">\(s\)</span> and the sample size <span class="math notranslate nohighlight">\(n\)</span> as inputs.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">mc</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
    <span class="n">est</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
        <span class="nb">sum</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
            <span class="nb">sum</span> <span class="o">+=</span> <span class="p">(</span><span class="n">invNormal</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">()))</span><span class="o">**</span><span class="mi">2</span>
        <span class="n">est</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">((</span><span class="nb">sum</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">**</span><span class="p">(</span><span class="n">s</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">est</span><span class="o">/</span><span class="n">n</span>
</pre></div>
</div>
</div>
</div>
<p>The exact value of the integral for <span class="math notranslate nohighlight">\(s=25\)</span> is <span class="math notranslate nohighlight">\(1.356914\times 10^6\)</span>. The
following code computes the relative error of the Monte Carlo estimate
with sample size <span class="math notranslate nohighlight">\(n\)</span>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">relerror</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">n</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">mc</span><span class="p">(</span><span class="mi">25</span><span class="p">,</span><span class="n">n</span><span class="p">)</span><span class="o">+</span><span class="mf">1.356914</span><span class="o">*</span><span class="mi">10</span><span class="o">**</span><span class="mi">6</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mf">1.356914</span><span class="o">*</span><span class="mi">10</span><span class="o">**</span><span class="mi">6</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Let’s plot the relative error of some Monte Carlo estimates. First, we
generate sample sizes from 50,000 to 1,000,000 in increments of 50,000.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">samples</span> <span class="o">=</span> <span class="p">[</span><span class="n">n</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">50000</span><span class="p">,</span><span class="mi">1000001</span><span class="p">,</span> <span class="mi">50000</span><span class="p">)]</span>
</pre></div>
</div>
</div>
</div>
<p>For each sample size, we compute the relative error, and then plot the
results.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">error</span> <span class="o">=</span> <span class="p">[</span><span class="n">relerror</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">samples</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">KeyboardInterrupt</span><span class="g g-Whitespace">                         </span>Traceback (most recent call last)
<span class="o">~</span>\<span class="n">AppData</span>\<span class="n">Local</span>\<span class="n">Temp</span><span class="o">/</span><span class="n">ipykernel_18972</span><span class="o">/</span><span class="mf">1912928011.</span><span class="n">py</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">error</span> <span class="o">=</span> <span class="p">[</span><span class="n">relerror</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">samples</span><span class="p">]</span>

<span class="nn">~\AppData\Local\Temp/ipykernel_18972/1912928011.py</span> in <span class="ni">&lt;listcomp&gt;</span><span class="nt">(.0)</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">error</span> <span class="o">=</span> <span class="p">[</span><span class="n">relerror</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">samples</span><span class="p">]</span>

<span class="nn">~\AppData\Local\Temp/ipykernel_18972/3218861989.py</span> in <span class="ni">&lt;lambda&gt;</span><span class="nt">(n)</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">relerror</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">n</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">mc</span><span class="p">(</span><span class="mi">25</span><span class="p">,</span><span class="n">n</span><span class="p">)</span><span class="o">+</span><span class="mf">1.356914</span><span class="o">*</span><span class="mi">10</span><span class="o">**</span><span class="mi">6</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mf">1.356914</span><span class="o">*</span><span class="mi">10</span><span class="o">**</span><span class="mi">6</span><span class="p">)</span>

<span class="nn">~\AppData\Local\Temp/ipykernel_18972/3735983042.py</span> in <span class="ni">mc</span><span class="nt">(s, n)</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span>         <span class="nb">sum</span> <span class="o">=</span> <span class="mi">0</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span>         <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
<span class="ne">----&gt; </span><span class="mi">6</span>             <span class="nb">sum</span> <span class="o">+=</span> <span class="p">(</span><span class="n">invNormal</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">()))</span><span class="o">**</span><span class="mi">2</span>
<span class="g g-Whitespace">      </span><span class="mi">7</span>         <span class="n">est</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">((</span><span class="nb">sum</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="mf">0.5</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">8</span>     <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">**</span><span class="p">(</span><span class="n">s</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">est</span><span class="o">/</span><span class="n">n</span>

<span class="nn">~\AppData\Local\Temp/ipykernel_18972/1158285544.py</span> in <span class="ni">invNormal</span><span class="nt">(u)</span>
<span class="g g-Whitespace">     </span><span class="mi">20</span> 
<span class="g g-Whitespace">     </span><span class="mi">21</span>     <span class="n">y</span> <span class="o">=</span> <span class="n">u</span><span class="o">-</span><span class="mf">0.5</span>
<span class="ne">---&gt; </span><span class="mi">22</span>     <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.42</span><span class="p">:</span>
<span class="g g-Whitespace">     </span><span class="mi">23</span>         <span class="n">r</span> <span class="o">=</span> <span class="n">y</span><span class="o">*</span><span class="n">y</span>
<span class="g g-Whitespace">     </span><span class="mi">24</span>         <span class="n">x</span> <span class="o">=</span> <span class="n">y</span><span class="o">*</span><span class="p">(((</span><span class="n">a3</span><span class="o">*</span><span class="n">r</span><span class="o">+</span><span class="n">a2</span><span class="p">)</span><span class="o">*</span><span class="n">r</span><span class="o">+</span><span class="n">a1</span><span class="p">)</span><span class="o">*</span><span class="n">r</span><span class="o">+</span><span class="n">a0</span><span class="p">)</span><span class="o">/</span><span class="p">((((</span><span class="n">b3</span><span class="o">*</span><span class="n">r</span><span class="o">+</span><span class="n">b2</span><span class="p">)</span><span class="o">*</span><span class="n">r</span><span class="o">+</span><span class="n">b1</span><span class="p">)</span><span class="o">*</span><span class="n">r</span><span class="o">+</span><span class="n">b0</span><span class="p">)</span><span class="o">*</span><span class="n">r</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>

<span class="ne">KeyboardInterrupt</span>: 
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">samples</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Sample size (n)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Relative error&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<figure class="align-default" id="mc-capstick">
<a class="reference internal image-reference" href="_images/mc_capstick.png"><img alt="_images/mc_capstick.png" src="_images/mc_capstick.png" style="height: 450px;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 15 </span><span class="caption-text">Monte Carlo relative error for the integral <a class="reference internal" href="#equation-capstick-test">(35)</a>.</span><a class="headerlink" href="#mc-capstick" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<div class="docutils container" id="id4">
<dl class="citation">
<dt class="label" id="id6"><span class="brackets"><a class="fn-backref" href="#id1">BFB16</a></span></dt>
<dd><p>R.L. Burden, D. Faires, and A.M. Burden. <em>Numerical Analysis</em>. Cengate, 10th edition, 2016.</p>
</dd>
<dt class="label" id="id14"><span class="brackets"><a class="fn-backref" href="#id2">CK96</a></span></dt>
<dd><p>S. Capstick and B.D. Keister. Multidimensional quadrature algorithms at higher degree and/or dimension. <em>Journal of Computational Physics</em>, 123:267–273, 1996.</p>
</dd>
<dt class="label" id="id15"><span class="brackets"><a class="fn-backref" href="#id3">Gla13</a></span></dt>
<dd><p>P. Glasserman. <em>Monte Carlo methods in Financial Engineering</em>. Springer, 2013.</p>
</dd>
</dl>
</div>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="bookchapter5-3.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">5.3 Gaussian quadrature</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="bookchapter5-5.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">5.5 Improper integrals</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By Yaning Liu, Giray Okten<br/>
  
      &copy; Copyright 2022.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>